# üìã –ü–û–õ–ù–´–ô –û–¢–ß–ï–¢: –î–ï–ü–õ–û–ô –ò –ó–ê–ü–£–°–ö –°–ï–†–í–ï–†–ê
## Looktown Bot ‚Üí Yandex Cloud Serverless Container

**–î–∞—Ç–∞ —Å–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è:** 2025-01-20  
**–ü—Ä–æ–µ–∫—Ç:** Looktown Bot  
**–¶–µ–ª–µ–≤–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞:** Yandex Cloud Serverless Container

---

## üîÑ –ß–ê–°–¢–¨ 1: –ü–†–û–¶–ï–°–° –î–ï–ü–õ–û–Ø (GitHub Actions)

### 1.1 –¢—Ä–∏–≥–≥–µ—Ä –¥–µ–ø–ª–æ—è
- **–£—Å–ª–æ–≤–∏–µ:** Push –≤ –≤–µ—Ç–∫–∏ `master` –∏–ª–∏ `main`
- **–§–∞–π–ª:** `.github/workflows/deploy-to-yc.yml`
- **Workflow name:** `Deploy to Yandex Cloud`

### 1.2 –®–∞–≥–∏ –¥–µ–ø–ª–æ—è (–ø–æ –ø–æ—Ä—è–¥–∫—É –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è)

#### –®–∞–≥ 1: Checkout repository
```yaml
- name: Checkout repository
  uses: actions/checkout@v4
```
- –ö–ª–æ–Ω–∏—Ä—É–µ—Ç —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –≤ runner
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –í—Å–µ —Ñ–∞–π–ª—ã –ø—Ä–æ–µ–∫—Ç–∞ –¥–æ—Å—Ç—É–ø–Ω—ã –≤ workspace

---

#### –®–∞–≥ 2: Login to Yandex Container Registry
```yaml
- name: Login to Yandex Container Registry
  uses: yc-actions/yc-cr-login@v1
  with:
    yc-sa-json-credentials: ${{ secrets.YC_SA_KEY }}
```
- –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –≤ Yandex Container Registry
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–µ–∫—Ä–µ—Ç `YC_SA_KEY` (JSON –∫–ª—é—á —Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞)
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** Docker –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è push –≤ `cr.yandex/*`

---

#### –®–∞–≥ 3: Set up QEMU
```yaml
- name: Set up QEMU
  uses: docker/setup-qemu-action@v3
```
- –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —ç–º—É–ª—è—Ü–∏–∏ –¥–ª—è multi-platform —Å–±–æ—Ä–∫–∏
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å–±–æ—Ä–∫–∏ –¥–ª—è `linux/amd64`

---

#### –®–∞–≥ 4: Set up Docker Buildx
```yaml
- name: Set up Docker Buildx
  uses: docker/setup-buildx-action@v3
```
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–π —Å–±–æ—Ä–∫–∏ Docker
- **–†–µ–∑—É–ª—å—Ç–∞—Ç:** Docker Buildx –≥–æ—Ç–æ–≤ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

---

#### –®–∞–≥ 5: Build and push Docker image
```yaml
- name: Build and push Docker image
  uses: docker/build-push-action@v5
  with:
    context: .
    push: true
    tags: |
      cr.yandex/${{ secrets.YC_REGISTRY_ID }}/looktown_bot:${{ github.sha }}
      cr.yandex/${{ secrets.YC_REGISTRY_ID }}/looktown_bot:latest
    platforms: linux/amd64
```

**–ü—Ä–æ—Ü–µ—Å—Å —Å–±–æ—Ä–∫–∏ –æ–±—Ä–∞–∑–∞:**
1. –ß–∏—Ç–∞–µ—Ç `Dockerfile` –∏–∑ –∫–æ—Ä–Ω—è –ø—Ä–æ–µ–∫—Ç–∞
2. –í—ã–ø–æ–ª–Ω—è–µ—Ç –∫–æ–º–∞–Ω–¥—ã –∏–∑ Dockerfile (—Å–º. —Ä–∞–∑–¥–µ–ª 2)
3. –°–æ–∑–¥–∞–µ—Ç Docker –æ–±—Ä–∞–∑
4. –¢–µ–≥–∏—Ä—É–µ—Ç –æ–±—Ä–∞–∑ –¥–≤—É–º—è —Ç–µ–≥–∞–º–∏:
   - `{SHA}` - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π —Ç–µ–≥ –ø–æ –∫–æ–º–º–∏—Ç—É
   - `latest` - –≤—Å–µ–≥–¥–∞ –ø–æ—Å–ª–µ–¥–Ω—è—è –≤–µ—Ä—Å–∏—è
5. –ó–∞–≥—Ä—É–∂–∞–µ—Ç –æ–±—Ä–∞–∑ –≤ `cr.yandex/{YC_REGISTRY_ID}/looktown_bot`

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** Docker –æ–±—Ä–∞–∑ –∑–∞–≥—Ä—É–∂–µ–Ω –≤ Yandex Container Registry

---

#### –®–∞–≥ 6: Deploy Serverless Container
```yaml
- name: Deploy Serverless Container
  id: deploy
  uses: yc-actions/yc-sls-container-deploy@v1
  with:
    yc-sa-json-credentials: ${{ secrets.YC_SA_KEY }}
    container-name: 'looktown_bot'
    folder-id: ${{ secrets.YANDEX_FOLDER_ID }}
    revision-image-url: cr.yandex/${{ secrets.YC_REGISTRY_ID }}/looktown_bot:${{ github.sha }}
    revision-service-account-id: ${{ secrets.YANDEX_SERVICE_ACCOUNT_ID }}
    revision-memory: '512MB'
    revision-execution-timeout: 30
    revision-env: |
      TELEGRAM_BOT_TOKEN=...
      YANDEX_API_KEY_ID=...
      # ... –∏ –¥—Ä—É–≥–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
```

**–ü—Ä–æ—Ü–µ—Å—Å –¥–µ–ø–ª–æ—è:**
1. –ü–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ Yandex Cloud —á–µ—Ä–µ–∑ `YC_SA_KEY`
2. –ù–∞—Ö–æ–¥–∏—Ç Serverless Container —Å –∏–º–µ–Ω–µ–º `looktown_bot`
3. –°–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—É—é —Ä–µ–≤–∏–∑–∏—é (revision) –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞:
   - **–û–±—Ä–∞–∑:** –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –æ–±—Ä–∞–∑ —Å —Ç–µ–≥–æ–º `{SHA}`
   - **Memory:** 512MB
   - **Timeout:** 30 —Å–µ–∫—É–Ω–¥
   - **Service Account:** ID –∏–∑ —Å–µ–∫—Ä–µ—Ç–∞
   - **Environment variables:** –í—Å–µ 12 –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
4. –ê–∫—Ç–∏–≤–∏—Ä—É–µ—Ç –Ω–æ–≤—É—é —Ä–µ–≤–∏–∑–∏—é

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –æ–±–Ω–æ–≤–ª–µ–Ω –Ω–æ–≤–æ–π —Ä–µ–≤–∏–∑–∏–µ–π, —Å—Ç–∞—Ä–∞—è —Ä–µ–≤–∏–∑–∏—è –æ—Å—Ç–∞–µ—Ç—Å—è –¥–ª—è rollback

**–í–∞–∂–Ω–æ:** –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä **–ù–ï –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏** - –æ–Ω –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–≤–æ–º HTTP-–∑–∞–ø—Ä–æ—Å–µ

---

#### –®–∞–≥ 7: Setup Yandex Cloud CLI and jq
```yaml
- name: Setup Yandex Cloud CLI and jq
  if: always()  # –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –¥–∞–∂–µ –µ—Å–ª–∏ –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —à–∞–≥–∏ —É–ø–∞–ª–∏
  run: |
    curl -sSL https://storage.yandexcloud.net/yandexcloud-yc/install.sh | bash
    export PATH=$PATH:$HOME/yandex-cloud/bin
    yc version
    sudo apt-get update && sudo apt-get install -y jq
```

**–ü—Ä–æ—Ü–µ—Å—Å:**
1. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç Yandex Cloud CLI (`yc`)
2. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç `jq` –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ JSON

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –≥–æ—Ç–æ–≤—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å YC API

---

#### –®–∞–≥ 8: Get Container URL and Set Webhook
```yaml
- name: Get Container URL and Set Webhook
  if: always()
  env:
    YC_SA_KEY_JSON: ${{ secrets.YC_SA_KEY }}
    TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
    YANDEX_FOLDER_ID: ${{ secrets.YANDEX_FOLDER_ID }}
  run: |
    # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ YC CLI
    # –ü–æ–ª—É—á–µ–Ω–∏–µ URL –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
    # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ webhook –≤ Telegram
```

**–ü—Ä–æ—Ü–µ—Å—Å:**
1. –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –ø—Ä–æ—Ñ–∏–ª—å `yc` —Å —Å–µ—Ä–≤–∏—Å–Ω—ã–º –∞–∫–∫–∞—É–Ω—Ç–æ–º
2. –ü–æ–ª—É—á–∞–µ—Ç URL –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –∫–æ–º–∞–Ω–¥–æ–π:
   ```bash
   yc serverless container get --name looktown_bot --format json
   ```
3. –ï—Å–ª–∏ URL –ø–æ–ª—É—á–µ–Ω:
   - –§–æ—Ä–º–∏—Ä—É–µ—Ç webhook URL: `{CONTAINER_URL}/webhook`
   - –í—ã–∑—ã–≤–∞–µ—Ç Telegram Bot API:
     ```bash
     curl -X POST "https://api.telegram.org/bot{TOKEN}/setWebhook" \
       -H "Content-Type: application/json" \
       -d '{"url": "{CONTAINER_URL}/webhook"}'
     ```
4. –ï—Å–ª–∏ URL –Ω–µ –ø–æ–ª—É—á–µ–Ω (–ø–µ—Ä–≤—ã–π –¥–µ–ø–ª–æ–π –∏–ª–∏ –æ—à–∏–±–∫–∞):
   - –í—ã–≤–æ–¥–∏—Ç –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è —Ä—É—á–Ω–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–∏
   - –ó–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è —É—Å–ø–µ—à–Ω–æ (exit 0)

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** Webhook —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ Telegram (–µ—Å–ª–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å—É—â–µ—Å—Ç–≤—É–µ—Ç)

---

## üê≥ –ß–ê–°–¢–¨ 2: –°–ë–û–†–ö–ê DOCKER –û–ë–†–ê–ó–ê

### 2.1 Dockerfile - —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–±–æ—Ä–∫–∏

**–ë–∞–∑–æ–≤—ã–π –æ–±—Ä–∞–∑:**
```dockerfile
FROM python:3.11-slim
```
- –û—Å–Ω–æ–≤–∞: –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π Python 3.11 slim (–º–∏–Ω–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π)
- –†–∞–∑–º–µ—Ä –±–∞–∑–æ–≤–æ–≥–æ –æ–±—Ä–∞–∑–∞: ~45MB

---

**–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:**
```dockerfile
ENV PYTHONDONTWRITEBYTECODE=1 \
    PYTHONUNBUFFERED=1 \
    PIP_NO_CACHE_DIR=1
```
- `PYTHONDONTWRITEBYTECODE=1` - –Ω–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å .pyc —Ñ–∞–π–ª—ã
- `PYTHONUNBUFFERED=1` - –æ—Ç–∫–ª—é—á–∏—Ç—å –±—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏—é stdout/stderr (–∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è –ª–æ–≥–æ–≤!)
- `PIP_NO_CACHE_DIR=1` - –Ω–µ –∫—ç—à–∏—Ä–æ–≤–∞—Ç—å pip –ø–∞–∫–µ—Ç—ã (—É–º–µ–Ω—å—à–∞–µ—Ç —Ä–∞–∑–º–µ—Ä)

---

**–†–∞–±–æ—á–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è:**
```dockerfile
WORKDIR /app
```
- –í—Å–µ –ø–æ—Å–ª–µ–¥—É—é—â–∏–µ –∫–æ–º–∞–Ω–¥—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤ `/app`

---

**–°–∏—Å—Ç–µ–º–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**
```dockerfile
RUN apt-get update && apt-get install -y --no-install-recommends \
    ca-certificates \
    && rm -rf /var/lib/apt/lists/*
```
- –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ `ca-certificates` (–Ω—É–∂–µ–Ω –¥–ª—è SSL/TLS)
- –£–¥–∞–ª—è–µ—Ç –∫—ç—à apt –¥–ª—è —É–º–µ–Ω—å—à–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–∞

---

**Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**
```dockerfile
COPY requirements.txt ./
RUN pip install -r requirements.txt
```

**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏–∑ requirements.txt:**
```
python-telegram-bot>=21.0  # Telegram Bot API
ydb[yc]                    # Yandex Database –∫–ª–∏–µ–Ω—Ç
python-dotenv              # –ó–∞–≥—Ä—É–∑–∫–∞ .env —Ñ–∞–π–ª–æ–≤
PyJWT                      # JWT —Ç–æ–∫–µ–Ω—ã
requests                   # HTTP –∑–∞–ø—Ä–æ—Å—ã
pytz                       # –ß–∞—Å–æ–≤—ã–µ –ø–æ—è—Å–∞
fastapi                    # FastAPI —Ñ—Ä–µ–π–º–≤–æ—Ä–∫
uvicorn[standard]          # ASGI —Å–µ—Ä–≤–µ—Ä –¥–ª—è FastAPI
```

**–ü—Ä–æ—Ü–µ—Å—Å —É—Å—Ç–∞–Ω–æ–≤–∫–∏:**
1. –ö–æ–ø–∏—Ä—É–µ—Ç—Å—è `requirements.txt` –≤ –æ–±—Ä–∞–∑
2. –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è `pip install -r requirements.txt`
3. –í—Å–µ –ø–∞–∫–µ—Ç—ã —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è –≤ —Å–∏—Å—Ç–µ–º–Ω—ã–π Python

---

**–ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –∫–æ–¥–∞:**
```dockerfile
COPY bot.py ./
COPY main.py ./
COPY service_factory.py ./
COPY src ./src
COPY start_server.py ./
RUN chmod +x /app/start_server.py
```

**–ö–æ–ø–∏—Ä—É–µ–º—ã–µ —Ñ–∞–π–ª—ã:**
- `bot.py` - –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (polling)
- `main.py` - –≥–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª –¥–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ (FastAPI + webhook)
- `service_factory.py` - —Ñ–∞–±—Ä–∏–∫–∞ —Å–µ—Ä–≤–∏—Å–æ–≤
- `src/` - –≤–µ—Å—å –∫–∞—Ç–∞–ª–æ–≥ —Å —Å–µ—Ä–≤–∏—Å–∞–º–∏
- `start_server.py` - wrapper —Å–∫—Ä–∏–ø—Ç –¥–ª—è –∑–∞–ø—É—Å–∫–∞

---

**–ö–æ–º–∞–Ω–¥–∞ –∑–∞–ø—É—Å–∫–∞:**
```dockerfile
CMD ["python", "/app/start_server.py"]
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç —Å–±–æ—Ä–∫–∏:**
- Docker –æ–±—Ä–∞–∑ –≥–æ—Ç–æ–≤
- –ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è `python /app/start_server.py`

---

## üöÄ –ß–ê–°–¢–¨ 3: –ó–ê–ü–£–°–ö –ö–û–ù–¢–ï–ô–ù–ï–†–ê –í YANDEX CLOUD

### 3.1 –ö–æ–≥–¥–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

**–í–∞–∂–Ω–æ:** Serverless Container –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è **–ª–µ–Ω–∏–≤–æ** (lazy):
- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä **–ù–ï –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è** —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è
- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø—Ä–∏ **–ø–µ—Ä–≤–æ–º HTTP-–∑–∞–ø—Ä–æ—Å–µ**
- Yandex Cloud —Å–æ–∑–¥–∞–µ—Ç —ç–∫–∑–µ–º–ø–ª—è—Ä –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –ø–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—é

**–ó–∞–ø—É—Å–∫ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∫–æ–≥–¥–∞:**
1. –ü—Ä–∏—Ö–æ–¥–∏—Ç HTTP-–∑–∞–ø—Ä–æ—Å –Ω–∞ URL –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –æ—Ç Telegram webhook)
2. Health check –ø—Ä–æ–≤–µ—Ä–∫–∞ (–µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞)
3. –†—É—á–Ω–æ–π –≤—ã–∑–æ–≤ —á–µ—Ä–µ–∑ API

---

### 3.2 –ü—Ä–æ—Ü–µ—Å—Å –∑–∞–ø—É—Å–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ (–ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å)

#### –≠—Ç–∞–ø 1: Yandex Cloud –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
1. YC –∑–∞–≥—Ä—É–∂–∞–µ—Ç Docker –æ–±—Ä–∞–∑ –∏–∑ Registry
2. –°–æ–∑–¥–∞–µ—Ç –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—É—é —Å—Ä–µ–¥—É –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
3. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏–∑ `revision-env`
4. –ó–∞–ø—É—Å–∫–∞–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å –ø–æ –∫–æ–º–∞–Ω–¥–µ `CMD` –∏–∑ Dockerfile

**–ö–æ–º–∞–Ω–¥–∞ –∑–∞–ø—É—Å–∫–∞:**
```bash
python /app/start_server.py
```

---

#### –≠—Ç–∞–ø 2: start_server.py - –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∏ –∑–∞–ø—É—Å–∫

**2.1 –û—Ç–∫–ª—é—á–µ–Ω–∏–µ –±—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏–∏:**
```python
if hasattr(sys.stdout, 'reconfigure'):
    sys.stdout.reconfigure(line_buffering=True)
    sys.stderr.reconfigure(line_buffering=True)
```
- **–¶–µ–ª—å:** –í—Å–µ –ª–æ–≥–∏ —Å—Ä–∞–∑—É –ø–æ–ø–∞–¥–∞—é—Ç –≤ stdout/stderr
- **–ö—Ä–∏—Ç–∏—á–Ω–æ:** –ë–µ–∑ —ç—Ç–æ–≥–æ –ª–æ–≥–∏ –º–æ–≥—É—Ç –Ω–µ –ø–æ—è–≤–∏—Ç—å—Å—è –≤ YC

**2.2 –ü–µ—Ä–≤–∏—á–Ω—ã–µ –ª–æ–≥–∏:**
```python
print("üöÄ START_SERVER.PY: –ù–∞—á–∞–ª–æ –∑–∞–ø—É—Å–∫–∞")
print(f"üìÇ –†–∞–±–æ—á–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è: {os.getcwd()}")
print(f"üêç Python: {sys.version}")
```
- **–í—ã–≤–æ–¥:** –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å—Ä–µ–¥–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —á—Ç–æ —Å–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å—Ç–∏–ª—Å—è

**2.3 –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–∞–π–ª–∞ main.py:**
```python
main_py_path = "/app/main.py"
if os.path.exists(main_py_path):
    print(f"‚úÖ –§–∞–π–ª {main_py_path} –Ω–∞–π–¥–µ–Ω")
else:
    print(f"‚ùå –§–∞–π–ª {main_py_path} –ù–ï –ù–ê–ô–î–ï–ù!")
    sys.exit(1)
```
- **–¶–µ–ª—å:** –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ —Ñ–∞–π–ª —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- **–ü—Ä–∏ –æ—à–∏–±–∫–µ:** –°–∫—Ä–∏–ø—Ç –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è —Å –∫–æ–¥–æ–º 1, –ª–æ–≥–∏ –≤–∏–¥–Ω—ã

**2.4 –ü—Ä–æ–≤–µ—Ä–∫–∞ uvicorn:**
```python
import uvicorn
print(f"‚úÖ uvicorn –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω, –≤–µ—Ä—Å–∏—è: {uvicorn.__version__}")
```
- **–¶–µ–ª—å:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ uvicorn —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
- **–ü—Ä–∏ –æ—à–∏–±–∫–µ:** –õ–æ–≥–∏—Ä—É–µ—Ç—Å—è –æ—à–∏–±–∫–∞, —Å–∫—Ä–∏–ø—Ç –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è

**2.5 –ò–º–ø–æ—Ä—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:**
```python
os.chdir("/app")
sys.path.insert(0, "/app")
import main
```
- **–¶–µ–ª—å:** –ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –º–æ–¥—É–ª—å `main`
- **–ü—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ:** –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤–µ—Å—å –∫–æ–¥ –≤–µ—Ä—Ö–Ω–µ–≥–æ —É—Ä–æ–≤–Ω—è –≤ `main.py`

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ `import main`:**
1. –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –∫–æ–¥ –∏–∑ –Ω–∞—á–∞–ª–∞ —Ñ–∞–π–ª–∞ `main.py` (—Å–º. —Ä–∞–∑–¥–µ–ª 4)
2. –ï—Å–ª–∏ –µ—Å—Ç—å –æ—à–∏–±–∫–∏ - –æ–Ω–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è –≤ stdout

**2.6 –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—ä–µ–∫—Ç–∞ app:**
```python
if hasattr(main, 'app'):
    print("‚úÖ –û–±—ä–µ–∫—Ç app –Ω–∞–π–¥–µ–Ω –≤ –º–æ–¥—É–ª–µ main")
else:
    print("‚ùå –û–±—ä–µ–∫—Ç app –ù–ï –Ω–∞–π–¥–µ–Ω –≤ –º–æ–¥—É–ª–µ main!")
    sys.exit(1)
```
- **–¶–µ–ª—å:** –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–æ
- **–ü—Ä–∏ –æ—à–∏–±–∫–µ:** –°–∫—Ä–∏–ø—Ç –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è

**2.7 –ó–∞–ø—É—Å–∫ uvicorn:**
```python
uvicorn.run(
    "main:app",
    host="0.0.0.0",
    port=8080,
    log_level="info",
    access_log=True
)
```
- **–ë–ª–æ–∫–∏—Ä—É—é—â–∏–π –≤—ã–∑–æ–≤:** –°–∫—Ä–∏–ø—Ç –æ–∂–∏–¥–∞–µ—Ç –∑–¥–µ—Å—å
- **Uvicorn –∑–∞–ø—É—Å–∫–∞–µ—Ç:** ASGI —Å–µ—Ä–≤–µ—Ä –Ω–∞ –ø–æ—Ä—Ç—É 8080
- **–õ–æ–≥–∏ uvicorn:** –ò–¥—É—Ç –≤ stdout –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

---

#### –≠—Ç–∞–ø 3: main.py - –∏–º–ø–æ—Ä—Ç –º–æ–¥—É–ª–µ–π

**–ü—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ `import main` –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è:**

**3.1 –†–∞–Ω–Ω–∏–µ –ª–æ–≥–∏ (–¥–æ –∏–º–ø–æ—Ä—Ç–æ–≤):**
```python
print("üöÄ –ù–ê–ß–ê–õ–û –ò–ú–ü–û–†–¢–ê –ú–û–î–£–õ–ï–ô")
```
- –ü–µ—Ä–≤—ã–µ —Å—Ç—Ä–æ–∫–∏ –∫–æ–¥–∞ –≤ `main.py`
- –õ–æ–≥–∏—Ä—É—é—Ç—Å—è –î–û –ª—é–±—ã—Ö –∏–º–ø–æ—Ä—Ç–æ–≤

**3.2 –ò–º–ø–æ—Ä—Ç dotenv:**
```python
try:
    from dotenv import load_dotenv
    print("‚úÖ dotenv –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω")
except Exception as e:
    print(f"‚ùå –û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞ dotenv: {e}")
    sys.exit(1)
```
- –ò–º–ø–æ—Ä—Ç –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ .env
- –ü—Ä–∏ –æ—à–∏–±–∫–µ: –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è –∏ –ø—Ä–æ—Ü–µ—Å—Å –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è

**3.3 –ó–∞–≥—Ä—É–∑–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è:**
```python
load_dotenv()
print("‚úÖ .env –∑–∞–≥—Ä—É–∂–µ–Ω")
```
- –ó–∞–≥—Ä—É–∂–∞–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–∑ .env (–µ—Å–ª–∏ —Ñ–∞–π–ª –µ—Å—Ç—å)
- –í –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ .env –æ–±—ã—á–Ω–æ –Ω–µ—Ç, –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ `revision-env`

**3.4 –ò–º–ø–æ—Ä—Ç FastAPI:**
```python
try:
    from fastapi import FastAPI, Request, BackgroundTasks
    print("‚úÖ FastAPI –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω")
except Exception as e:
    print(f"‚ùå –û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞ FastAPI: {e}")
    sys.exit(1)
```
- –ò–º–ø–æ—Ä—Ç FastAPI –∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –∫–ª–∞—Å—Å–æ–≤
- –ü—Ä–∏ –æ—à–∏–±–∫–µ: –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è –∏ –ø—Ä–æ—Ü–µ—Å—Å –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è

**3.5 –ò–º–ø–æ—Ä—Ç Telegram –±–∏–±–ª–∏–æ—Ç–µ–∫:**
```python
try:
    from telegram import Update
    from telegram.ext import Application, CommandHandler, ...
    print("‚úÖ telegram –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã")
except Exception as e:
    print(f"‚ùå –û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞ telegram: {e}")
    sys.exit(1)
```
- –ò–º–ø–æ—Ä—Ç python-telegram-bot
- –ü—Ä–∏ –æ—à–∏–±–∫–µ: –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è –∏ –ø—Ä–æ—Ü–µ—Å—Å –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è

**3.6 –ò–º–ø–æ—Ä—Ç —Å–µ—Ä–≤–∏—Å–æ–≤:**
```python
try:
    from service_factory import get_yandex_agent_service
    print("‚úÖ service_factory –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω")
except Exception as e:
    print(f"‚ùå –û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞ service_factory: {e}")
    sys.exit(1)

try:
    from src.services.logger_service import logger
    print("‚úÖ logger –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω")
except Exception as e:
    print(f"‚ùå –û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞ logger: {e}")
    sys.exit(1)
```
- –ò–º–ø–æ—Ä—Ç –∫–∞—Å—Ç–æ–º–Ω—ã—Ö –º–æ–¥—É–ª–µ–π –ø—Ä–æ–µ–∫—Ç–∞
- –ü—Ä–∏ –æ—à–∏–±–∫–µ: –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è –∏ –ø—Ä–æ—Ü–µ—Å—Å –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è

**3.7 –ß—Ç–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è:**
```python
TELEGRAM_TOKEN = os.getenv('TELEGRAM_BOT_TOKEN')
WEBHOOK_URL = os.getenv('WEBHOOK_URL')
WEBHOOK_PATH = os.getenv('WEBHOOK_PATH', '/webhook')
```
- –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —É–∂–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –∏–∑ `revision-env`
- –ï—Å–ª–∏ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã - –∑–Ω–∞—á–µ–Ω–∏—è –±—É–¥—É—Ç `None`

**3.8 –°–æ–∑–¥–∞–Ω–∏–µ FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:**
```python
app = FastAPI(
    title="Looktown Bot",
    version="0.1.0"
)
```
- –°–æ–∑–¥–∞–µ—Ç—Å—è –æ–±—ä–µ–∫—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è FastAPI
- –ù–∞ —ç—Ç–æ–º —ç—Ç–∞–ø–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –µ—â–µ –Ω–µ –∑–∞–ø—É—â–µ–Ω–æ

**3.9 –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤:**
```python
async def start(update: Update, context: ContextTypes.DEFAULT_TYPE): ...
async def new_chat(update: Update, context: ContextTypes.DEFAULT_TYPE): ...
async def handle_message(update: Update, context: ContextTypes.DEFAULT_TYPE): ...
```
- –û–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è —Ñ—É–Ω–∫—Ü–∏–∏-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥ –∏ —Å–æ–æ–±—â–µ–Ω–∏–π
- –ï—â–µ –Ω–µ –ø—Ä–∏–≤—è–∑–∞–Ω—ã –∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é Telegram

**3.10 –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤ FastAPI:**
```python
@app.get("/", tags=["Root"])
def root(): ...

@app.get("/health", tags=["Health Check"])
@app.get("/healthcheck", tags=["Health Check"])
def health_check(): ...

@app.post(WEBHOOK_PATH, tags=["Telegram"])
async def webhook(request: Request, background_tasks: BackgroundTasks): ...
```
- –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É—é—Ç—Å—è HTTP —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
- FastAPI –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç —Ä–æ—É—Ç–∏–Ω–≥

**3.11 –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å–æ–±—ã—Ç–∏–π –∂–∏–∑–Ω–µ–Ω–Ω–æ–≥–æ —Ü–∏–∫–ª–∞:**
```python
@app.on_event("startup")
async def startup_event(): ...

@app.on_event("shutdown")
async def shutdown_event(): ...
```
- –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É—é—Ç—Å—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ startup/shutdown
- **–ï—â–µ –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã** - –≤—ã–ø–æ–ª–Ω—è—Ç—Å—è –∫–æ–≥–¥–∞ uvicorn –∑–∞–ø—É—Å—Ç–∏—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

---

#### –≠—Ç–∞–ø 4: Uvicorn –∑–∞–ø—É—Å–∫–∞–µ—Ç FastAPI

**4.1 Uvicorn –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è:**
- Uvicorn –∑–∞–≥—Ä—É–∂–∞–µ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ `main:app`
- –°–æ–∑–¥–∞–µ—Ç ASGI —Å–µ—Ä–≤–µ—Ä
- –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫—É HTTP –∑–∞–ø—Ä–æ—Å–æ–≤

**4.2 FastAPI startup —Å–æ–±—ã—Ç–∏–µ:**
```python
@app.on_event("startup")
async def startup_event():
    print("üöÄ FastAPI startup: –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è...")
```

**–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è startup:**

1. **–°–æ–∑–¥–∞–Ω–∏–µ key.json (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ):**
   ```python
   yc_sa_key_json = os.getenv('YC_SA_KEY_JSON')
   if yc_sa_key_json:
       with open('/app/key.json', 'w') as f:
           f.write(yc_sa_key_json)
       os.environ['YANDEX_SERVICE_ACCOUNT_KEY_FILE'] = '/app/key.json'
   ```
   - –°–æ–∑–¥–∞–µ—Ç —Ñ–∞–π–ª key.json –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è
   - –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è Yandex SDK

2. **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ Telegram –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:**
   ```python
   setup_application()
   ```
   - –°–æ–∑–¥–∞–µ—Ç –æ–±—ä–µ–∫—Ç `Application` –∏–∑ python-telegram-bot
   - –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥ –∏ —Å–æ–æ–±—â–µ–Ω–∏–π
   - **–ù–ï –∑–∞–ø—É—Å–∫–∞–µ—Ç polling** (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è webhook)

3. **–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:**
   ```python
   await application.initialize()
   await application.start()
   ```
   - –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
   - –ó–∞–ø—É—Å–∫–∞–µ—Ç —Ñ–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏ (–µ—Å–ª–∏ –µ—Å—Ç—å)
   - **–ì–æ—Ç–æ–≤ –∫ –æ–±—Ä–∞–±–æ—Ç–∫–µ updates —á–µ—Ä–µ–∑ webhook**

4. **–£—Å—Ç–∞–Ω–æ–≤–∫–∞ webhook (–µ—Å–ª–∏ URL –∑–∞–¥–∞–Ω):**
   ```python
   if WEBHOOK_URL:
       webhook_url = f"{WEBHOOK_URL.rstrip('/')}{WEBHOOK_PATH}"
       await application.bot.set_webhook(url=webhook_url)
   ```
   - –í—ã–∑—ã–≤–∞–µ—Ç Telegram Bot API
   - –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç webhook URL
   - –ï—Å–ª–∏ WEBHOOK_URL –Ω–µ –∑–∞–¥–∞–Ω - webhook –Ω–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è (–±—É–¥–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ø–æ–∑–∂–µ —á–µ—Ä–µ–∑ GitHub Actions)

5. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ä–≤–∏—Å–æ–≤:**
   ```python
   get_yandex_agent_service()
   ```
   - –ü—ã—Ç–∞–µ—Ç—Å—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å–µ—Ä–≤–∏—Å—ã
   - –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ - —Ç–æ–ª—å–∫–æ warning (–Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ)

**4.3 Uvicorn –Ω–∞—á–∏–Ω–∞–µ—Ç —Å–ª—É—à–∞—Ç—å –ø–æ—Ä—Ç 8080:**
- –ü—Ä–∏–≤—è–∑—ã–≤–∞–µ—Ç—Å—è –∫ `0.0.0.0:8080` (–≤—Å–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã)
- –ì–æ—Ç–æ–≤ –ø—Ä–∏–Ω–∏–º–∞—Ç—å HTTP –∑–∞–ø—Ä–æ—Å—ã
- –õ–æ–≥–∏—Ä—É–µ—Ç: `Uvicorn running on http://0.0.0.0:8080`

**4.4 –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –≥–æ—Ç–æ–≤:**
- FastAPI –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—â–µ–Ω–æ
- Uvicorn —Å–ª—É—à–∞–µ—Ç –ø–æ—Ä—Ç 8080
- Telegram –±–æ—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω
- –í—Å–µ –ª–æ–≥–∏ –≤—ã–≤–æ–¥—è—Ç—Å—è –≤ stdout

---

### 3.3 –û–±—Ä–∞–±–æ—Ç–∫–∞ HTTP –∑–∞–ø—Ä–æ—Å–æ–≤

**–ö–æ–≥–¥–∞ –ø—Ä–∏—Ö–æ–¥–∏—Ç HTTP –∑–∞–ø—Ä–æ—Å:**

1. **Yandex Cloud –ø–æ–ª—É—á–∞–µ—Ç –∑–∞–ø—Ä–æ—Å:**
   - –ó–∞–ø—Ä–æ—Å –ø—Ä–∏—Ö–æ–¥–∏—Ç –Ω–∞ –ø—É–±–ª–∏—á–Ω—ã–π URL –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
   - YC –º–∞—Ä—à—Ä—É—Ç–∏–∑–∏—Ä—É–µ—Ç –µ–≥–æ –Ω–∞ –ø–æ—Ä—Ç 8080 –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞

2. **Uvicorn –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–ø—Ä–æ—Å:**
   - –ü–æ–ª—É—á–∞–µ—Ç HTTP –∑–∞–ø—Ä–æ—Å
   - –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Ä–æ—É—Ç –ø–æ –ø—É—Ç–∏
   - –°–æ–∑–¥–∞–µ—Ç ASGI scope

3. **FastAPI –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–ø—Ä–æ—Å:**
   - –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π —ç–Ω–¥–ø–æ–∏–Ω—Ç
   - –í—ã–ø–æ–ª–Ω—è–µ—Ç middleware (–µ—Å–ª–∏ –µ—Å—Ç—å)
   - –í—ã–∑—ã–≤–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏—é-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫

4. **–ï—Å–ª–∏ –∑–∞–ø—Ä–æ—Å - Telegram webhook:**
   ```
   POST /webhook
   ```
   - –ü–æ–ø–∞–¥–∞–µ—Ç –≤ —Ñ—É–Ω–∫—Ü–∏—é `webhook()`
   - –ü–∞—Ä—Å–∏—Ç—Å—è JSON –∏–∑ —Ç–µ–ª–∞ –∑–∞–ø—Ä–æ—Å–∞
   - –°–æ–∑–¥–∞–µ—Ç—Å—è –æ–±—ä–µ–∫—Ç `Update` –∏–∑ Telegram API
   - –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ —Ñ–æ–Ω–µ —á–µ—Ä–µ–∑ `BackgroundTasks`
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è `{"ok": True}`

5. **–ï—Å–ª–∏ –∑–∞–ø—Ä–æ—Å - Health check:**
   ```
   GET /health
   GET /healthcheck
   ```
   - –ü–æ–ø–∞–¥–∞–µ—Ç –≤ —Ñ—É–Ω–∫—Ü–∏—é `health_check()`
   - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è `{"status": "OK", ...}`

6. **–ï—Å–ª–∏ –∑–∞–ø—Ä–æ—Å - –∫–æ—Ä–Ω–µ–≤–æ–π –ø—É—Ç—å:**
   ```
   GET /
   POST /
   ```
   - –ü–æ–ø–∞–¥–∞–µ—Ç –≤ `root()` –∏–ª–∏ `root_post()`
   - –ú–æ–∂–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –∫–∞–∫ Telegram webhook (POST) –∏–ª–∏ –≤–µ—Ä–Ω—É—Ç—å —Å—Ç–∞—Ç—É—Å (GET)

---

## üìä –ß–ê–°–¢–¨ 4: –õ–û–ì–ò–†–û–í–ê–ù–ò–ï –ò –î–ò–ê–ì–ù–û–°–¢–ò–ö–ê

### 4.1 –ì–¥–µ –ø–æ—è–≤–ª—è—é—Ç—Å—è –ª–æ–≥–∏

**–í—Å–µ –ª–æ–≥–∏ –∏–¥—É—Ç –≤ stdout/stderr –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞:**
- `print()` —Å `flush=True` ‚Üí stdout
- `logger.*()` ‚Üí stdout/stderr (–∑–∞–≤–∏—Å–∏—Ç –æ—Ç —É—Ä–æ–≤–Ω—è)
- `uvicorn` –ª–æ–≥–∏ ‚Üí stdout
- –û—à–∏–±–∫–∏ Python ‚Üí stderr

**Yandex Cloud —Å–æ–±–∏—Ä–∞–µ—Ç –ª–æ–≥–∏:**
- –í—Å–µ stdout/stderr –ø–æ–ø–∞–¥–∞—é—Ç –≤ —Å–∏—Å—Ç–µ–º—É –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è YC
- –î–æ—Å—Ç—É–ø–Ω—ã –≤ –∫–æ–Ω—Å–æ–ª–∏ YC –≤ —Ä–∞–∑–¥–µ–ª–µ "–õ–æ–≥–∏"
- –ú–æ–∂–Ω–æ —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –ø–æ –≤—Ä–µ–º–µ–Ω–∏, —É—Ä–æ–≤–Ω—é, —Ç–µ–∫—Å—Ç—É

---

### 4.2 –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ª–æ–≥–æ–≤ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ

**–û–∂–∏–¥–∞–µ–º–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å:**

1. **start_server.py:**
   ```
   ================================================================================
   üöÄ START_SERVER.PY: –ù–∞—á–∞–ª–æ –∑–∞–ø—É—Å–∫–∞
   ================================================================================
   üìÇ –†–∞–±–æ—á–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è: /app
   üêç Python: 3.11.x
   ‚úÖ –§–∞–π–ª /app/main.py –Ω–∞–π–¥–µ–Ω
   ‚úÖ uvicorn –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω, –≤–µ—Ä—Å–∏—è: 0.x.x
   ‚úÖ –ú–æ–¥—É–ª—å main –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω
   ‚úÖ –û–±—ä–µ–∫—Ç app –Ω–∞–π–¥–µ–Ω –≤ –º–æ–¥—É–ª–µ main
   ‚úÖ –í–°–ï –ü–†–û–í–ï–†–ö–ò –ü–†–û–ô–î–ï–ù–´, –ó–ê–ü–£–°–ö–ê–ï–ú UVICORN
   ```

2. **main.py (–ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ):**
   ```
   ============================================================
   üöÄ –ù–ê–ß–ê–õ–û –ò–ú–ü–û–†–¢–ê –ú–û–î–£–õ–ï–ô
   ============================================================
   ‚úÖ dotenv –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω
   ‚úÖ .env –∑–∞–≥—Ä—É–∂–µ–Ω
   ‚úÖ FastAPI –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω
   ‚úÖ telegram –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã
   ‚úÖ service_factory –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω
   ‚úÖ logger –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω
   ‚úÖ –í–°–ï –ò–ú–ü–û–†–¢–´ –£–°–ü–ï–®–ù–´
   ```

3. **Uvicorn —Å—Ç–∞—Ä—Ç:**
   ```
   INFO:     Started server process [1]
   INFO:     Waiting for application startup.
   ```

4. **FastAPI startup:**
   ```
   ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   ‚ïë üöÄ FastAPI startup: –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è...
   ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è Telegram...
   ‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ Telegram –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ
   üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è...
   ‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ Telegram –∑–∞–ø—É—â–µ–Ω–æ
   ```

5. **Uvicorn –≥–æ—Ç–æ–≤:**
   ```
   INFO:     Application startup complete.
   INFO:     Uvicorn running on http://0.0.0.0:8080 (Press CTRL+C to quit)
   ```

---

### 4.3 –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ –∏—Ö –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

**–ü—Ä–æ–±–ª–µ–º–∞: –ù–µ—Ç –ª–æ–≥–æ–≤ –≤–æ–æ–±—â–µ**
- **–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:**
  1. –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è (–æ—à–∏–±–∫–∞ –Ω–∞ —ç—Ç–∞–ø–µ YC)
  2. –°–∫—Ä–∏–ø—Ç –ø–∞–¥–∞–µ—Ç –¥–æ –ø–µ—Ä–≤–æ–≥–æ `print()`
  3. –ë—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏—è –Ω–µ –æ—Ç–∫–ª—é—á–µ–Ω–∞
- **–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ `PYTHONUNBUFFERED=1` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω

**–ü—Ä–æ–±–ª–µ–º–∞: –õ–æ–≥–∏ –µ—Å—Ç—å –¥–æ –∏–º–ø–æ—Ä—Ç–∞ main, –Ω–æ –ø–æ—Ç–æ–º –æ–±—Ä—ã–≤–∞—é—Ç—Å—è**
- **–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:**
  1. –û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞ –≤ `main.py`
  2. –û—à–∏–±–∫–∞ –≤ –∫–æ–¥–µ –≤–µ—Ä—Ö–Ω–µ–≥–æ —É—Ä–æ–≤–Ω—è
  3. `sys.exit()` –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ
- **–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –¥–æ —Å—Ç—Ä–æ–∫–∏ —Å –ø–æ—Å–ª–µ–¥–Ω–∏–º —É—Å–ø–µ—à–Ω—ã–º –∏–º–ø–æ—Ä—Ç–æ–º

**–ü—Ä–æ–±–ª–µ–º–∞: –õ–æ–≥–∏ –µ—Å—Ç—å, –Ω–æ uvicorn –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è**
- **–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:**
  1. –û—à–∏–±–∫–∞ –≤ `uvicorn.run()`
  2. –ü–æ—Ä—Ç 8080 –∑–∞–Ω—è—Ç (–Ω–µ–≤–µ—Ä–æ—è—Ç–Ω–æ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ)
  3. –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ `main:app`
- **–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ uvicorn, –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ `app` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç

**–ü—Ä–æ–±–ª–µ–º–∞: Uvicorn –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è, –Ω–æ startup —Å–æ–±—ã—Ç–∏–µ –Ω–µ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è**
- **–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:**
  1. –û—à–∏–±–∫–∞ –≤ `startup_event()` –∫–æ—Ç–æ—Ä–∞—è –Ω–µ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è
  2. –ò—Å–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–æ–≥–ª–∞—Ç—ã–≤–∞–µ—Ç—Å—è
- **–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –≤ `startup_event()`, –¥–æ–±–∞–≤–∏—Ç—å –±–æ–ª—å—à–µ print()

**–ü—Ä–æ–±–ª–µ–º–∞: –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è, –Ω–æ webhook –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç**
- **–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:**
  1. `WEBHOOK_URL` –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
  2. Webhook –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ Telegram (–ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á–µ—Ä–µ–∑ GitHub Actions)
  3. –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø—É—Ç—å `/webhook`
- **–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `WEBHOOK_URL`, –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ GitHub Actions

---

## üîê –ß–ê–°–¢–¨ 5: –ü–ï–†–ï–ú–ï–ù–ù–´–ï –û–ö–†–£–ñ–ï–ù–ò–Ø

### 5.1 –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ, –ø–µ—Ä–µ–¥–∞–≤–∞–µ–º—ã–µ –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä

**–ò–∑ `.github/workflows/deploy-to-yc.yml` (revision-env):**

1. `TELEGRAM_BOT_TOKEN` - —Ç–æ–∫–µ–Ω Telegram –±–æ—Ç–∞ (–∫—Ä–∏—Ç–∏—á–Ω–æ)
2. `YANDEX_API_KEY_ID` - ID API –∫–ª—é—á–∞ Yandex
3. `YANDEX_API_KEY_SECRET` - —Å–µ–∫—Ä–µ—Ç API –∫–ª—é—á–∞ Yandex
4. `YANDEX_FOLDER_ID` - ID –ø–∞–ø–∫–∏ –≤ Yandex Cloud
5. `YANDEX_SERVICE_ACCOUNT_ID` - ID —Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞
6. `YDB_ENDPOINT` - endpoint YDB (–∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ë–î)
7. `YDB_DATABASE` - –ø—É—Ç—å –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö YDB (–∫—Ä–∏—Ç–∏—á–Ω–æ)
8. `RESPONSES_BASE_URL` - URL –¥–ª—è Responses API
9. `YC_AGENT_ID` - ID –∞–≥–µ–Ω—Ç–∞ –≤ Yandex Cloud
10. `DEBUG` - —Ä–µ–∂–∏–º –æ—Ç–ª–∞–¥–∫–∏ (true/false)
11. `YC_SA_KEY_JSON` - JSON –∫–ª—é—á —Å–µ—Ä–≤–∏—Å–Ω–æ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞ (–¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è key.json)
12. `CONTAINER_NAME` - –∏–º—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ (`looktown_bot`)

**–í–∞–∂–Ω–æ:**
- –í—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–æ—Å—Ç—É–ø–Ω—ã —á–µ—Ä–µ–∑ `os.getenv()`
- `PORT` –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è **–ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è** (–ø–æ—Ä—Ç –∑–∞—Ö–∞—Ä–¥–∫–æ–∂–µ–Ω 8080)
- `WEBHOOK_URL` **–ù–ï –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è** –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä (—É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ GitHub Actions)

---

## üìù –ß–ê–°–¢–¨ 6: –†–ï–ó–Æ–ú–ï –ü–û–°–õ–ï–î–û–í–ê–¢–ï–õ–¨–ù–û–°–¢–ò –ó–ê–ü–£–°–ö–ê

### –ü–æ–ª–Ω–∞—è —Ü–µ–ø–æ—á–∫–∞ –æ—Ç –¥–µ–ø–ª–æ—è –¥–æ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤:

```
1. Push –≤ GitHub
   ‚Üì
2. GitHub Actions –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
   ‚Üì
3. –°–±–æ—Ä–∫–∞ Docker –æ–±—Ä–∞–∑–∞
   ‚Üì
4. –ó–∞–≥—Ä—É–∑–∫–∞ –æ–±—Ä–∞–∑–∞ –≤ Registry
   ‚Üì
5. –î–µ–ø–ª–æ–π –Ω–æ–≤–æ–π —Ä–µ–≤–∏–∑–∏–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
   ‚Üì
6. –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –∂–¥–µ—Ç –ø–µ—Ä–≤–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ (–ª–µ–Ω–∏–≤—ã–π –∑–∞–ø—É—Å–∫)
   ‚Üì
7. –ü—Ä–∏—Ö–æ–¥–∏—Ç HTTP –∑–∞–ø—Ä–æ—Å ‚Üí YC –∑–∞–ø—É—Å–∫–∞–µ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
   ‚Üì
8. Python –∑–∞–ø—É—Å–∫–∞–µ—Ç start_server.py
   ‚Üì
9. start_server.py –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –æ–∫—Ä—É–∂–µ–Ω–∏–µ
   ‚Üì
10. start_server.py –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç main.py
   ‚Üì
11. main.py –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –≤—Å–µ –º–æ–¥—É–ª–∏ (–ª–æ–≥–∏—Ä—É–µ—Ç –∫–∞–∂–¥—ã–π —à–∞–≥)
   ‚Üì
12. main.py —Å–æ–∑–¥–∞–µ—Ç FastAPI app
   ‚Üì
13. start_server.py –∑–∞–ø—É—Å–∫–∞–µ—Ç uvicorn
   ‚Üì
14. Uvicorn –∑–∞–≥—Ä—É–∂–∞–µ—Ç FastAPI app
   ‚Üì
15. FastAPI –≤—ã–ø–æ–ª–Ω—è–µ—Ç startup_event()
   ‚Üì
16. startup_event() –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç Telegram –±–æ—Ç–∞
   ‚Üì
17. Uvicorn –Ω–∞—á–∏–Ω–∞–µ—Ç —Å–ª—É—à–∞—Ç—å –ø–æ—Ä—Ç 8080
   ‚Üì
18. –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –≥–æ—Ç–æ–≤ –∫ –æ–±—Ä–∞–±–æ—Ç–∫–µ –∑–∞–ø—Ä–æ—Å–æ–≤
   ‚Üì
19. HTTP –∑–∞–ø—Ä–æ—Å—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ FastAPI —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
```

---

## ‚ö†Ô∏è –ß–ê–°–¢–¨ 7: –ö–†–ò–¢–ò–ß–ù–´–ï –ú–û–ú–ï–ù–¢–´

### –ß—Ç–æ –º–æ–∂–µ—Ç –ø–æ–π—Ç–∏ –Ω–µ —Ç–∞–∫:

1. **–û—à–∏–±–∫–∞ —Å–±–æ—Ä–∫–∏ –æ–±—Ä–∞–∑–∞:**
   - –ü—Ä–æ–±–ª–µ–º–∞ —Å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏
   - –û—à–∏–±–∫–∞ –≤ Dockerfile
   - **–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ GitHub Actions

2. **–û—à–∏–±–∫–∞ –¥–µ–ø–ª–æ—è:**
   - –ù–µ–≤–µ—Ä–Ω—ã–µ credentials
   - –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
   - **–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–µ–∫—Ä–µ—Ç—ã, —Å–æ–∑–¥–∞—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –≤—Ä—É—á–Ω—É—é

3. **–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è:**
   - –û—à–∏–±–∫–∞ –≤ start_server.py
   - –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç main.py
   - **–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –≤ YC

4. **–û—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞:**
   - –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å
   - –°–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –≤ –∫–æ–¥–µ
   - **–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –∏–º–ø–æ—Ä—Ç–∞ –≤ main.py

5. **–û—à–∏–±–∫–∞ startup:**
   - –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Telegram
   - –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è key.json
   - **–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ startup_event()

6. **Webhook –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:**
   - WEBHOOK_URL –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
   - –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π URL –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
   - **–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ GitHub Actions (—à–∞–≥ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ webhook)

---

**–ö–æ–Ω–µ—Ü –æ—Ç—á–µ—Ç–∞**

