#!/bin/sh
set -e

# Ð›Ð¾Ð³Ð¸Ñ€ÑƒÐµÐ¼ Ð½Ð°Ñ‡Ð°Ð»Ð¾ Ð·Ð°Ð¿ÑƒÑÐºÐ°
echo "==========================================" >&2
echo "ðŸš€ ENTRYPOINT: ÐÐ°Ñ‡Ð°Ð»Ð¾ Ð·Ð°Ð¿ÑƒÑÐºÐ° ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€Ð°" >&2
echo "==========================================" >&2

# Ð•ÑÐ»Ð¸ ÑÐµÐºÑ€ÐµÑ‚ ÑÐµÑ€Ð²Ð¸ÑÐ½Ð¾Ð³Ð¾ Ð°ÐºÐºÐ°ÑƒÐ½Ñ‚Ð° Ð¿ÐµÑ€ÐµÐ´Ð°Ð½ ÐºÐ°Ðº Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ð°Ñ, ÑÐ¾Ð·Ð´Ð°Ð´Ð¸Ð¼ key.json Ð² Ñ€Ð°Ð½Ñ‚Ð°Ð¹Ð¼Ðµ
if [ -n "$YC_SA_KEY_JSON" ]; then
  echo "ðŸ“ Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ key.json Ð¸Ð· Ð¿ÐµÑ€ÐµÐ¼ÐµÐ½Ð½Ð¾Ð¹ Ð¾ÐºÑ€ÑƒÐ¶ÐµÐ½Ð¸Ñ..." >&2
  echo "$YC_SA_KEY_JSON" > /app/key.json
  export YANDEX_SERVICE_ACCOUNT_KEY_FILE=/app/key.json
  export YC_SERVICE_ACCOUNT_KEY_FILE=/app/key.json
  echo "âœ… key.json ÑÐ¾Ð·Ð´Ð°Ð½" >&2
else
  echo "âš ï¸ YC_SA_KEY_JSON Ð½Ðµ Ð·Ð°Ð´Ð°Ð½, key.json Ð½Ðµ Ð±ÑƒÐ´ÐµÑ‚ ÑÐ¾Ð·Ð´Ð°Ð½" >&2
fi

# Ð’Ñ‹Ð²Ð¾Ð´Ð¸Ð¼ Ð±Ð°Ð·Ð¾Ð²ÑƒÑŽ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸ÑŽ Ð¾ ÑÑ€ÐµÐ´Ðµ
echo "ðŸ“ Ð Ð°Ð±Ð¾Ñ‡Ð°Ñ Ð´Ð¸Ñ€ÐµÐºÑ‚Ð¾Ñ€Ð¸Ñ: $(pwd)" >&2
echo "ðŸ Python: $(python --version)" >&2
echo "ðŸ“¦ PORT: ${PORT:-8080}" >&2

# Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÐ¼ main.py Ð´Ð»Ñ ÐºÐ¾Ð½Ñ‚ÐµÐ¹Ð½ÐµÑ€Ð° (webhook Ñ€ÐµÐ¶Ð¸Ð¼)
echo "ðŸš€ Ð—Ð°Ð¿ÑƒÑÐº main.py..." >&2
exec python /app/main.py


